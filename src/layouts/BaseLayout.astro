---
interface Props {
  title: string;
  description?: string;
}

const { title, description = "AI-powered power quality monitoring and forecasting for data centers and mission-critical facilities" } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="https://res.cloudinary.com/di54rmpjf/image/upload/v1758909007/voltry_favicon_x0moz6.png">
  <meta name="generator" content={Astro.generator}>
  <meta name="description" content={description}>

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:site_name" content="Voltry">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>

  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <title>{title}</title>
</head>
<body>
  <a href="#main-content" class="skip-to-content">Skip to main content</a>
  <slot />

  <!-- Back to Top Button -->
  <button class="back-to-top" aria-label="Back to top" title="Back to top">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="18 15 12 9 6 15"></polyline>
    </svg>
  </button>

  <!-- Theme Toggle Script (runs immediately to prevent flash) -->
  <script is:inline>
    // Initialize theme from localStorage or system preference
    function initTheme() {
      const storedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = storedTheme || (prefersDark ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', theme);
    }

    initTheme();

    // Listen for theme changes
    window.addEventListener('theme-toggle', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });
  </script>

  <!-- Netlify Identity Redirect Script -->
  <script is:inline>
    if (window.netlifyIdentity) {
      window.netlifyIdentity.on("init", user => {
        if (!user) {
          window.netlifyIdentity.on("login", () => {
            document.location.href = "/admin/";
          });
        }
      });
    }
  </script>

  <!-- Back to Top Button Script -->
  <script is:inline>
    const backToTopBtn = document.querySelector('.back-to-top');

    function toggleBackToTop() {
      if (window.scrollY > 500) {
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
      }
    }

    window.addEventListener('scroll', toggleBackToTop, { passive: true });

    backToTopBtn?.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  </script>
</body>
</html>

<style is:global>
  @import '../styles/global.css';

  /* Skip to content link for accessibility */
  .skip-to-content {
    position: absolute;
    top: -100px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--color-primary-600);
    color: white;
    padding: var(--space-3) var(--space-6);
    border-radius: var(--radius-md);
    font-weight: var(--weight-semibold);
    text-decoration: none;
    z-index: 9999;
    transition: top var(--transition-fast);
  }

  .skip-to-content:focus {
    top: var(--space-4);
    outline: 2px solid var(--color-accent-500);
    outline-offset: 2px;
  }

  /* Smooth scroll behavior */
  html {
    scroll-behavior: smooth;
  }

  @media (prefers-reduced-motion: reduce) {
    html {
      scroll-behavior: auto;
    }
  }

  /* Back to Top Button */
  .back-to-top {
    position: fixed;
    bottom: var(--space-6);
    right: var(--space-6);
    width: 48px;
    height: 48px;
    background: var(--color-primary-600);
    color: white;
    border: none;
    border-radius: var(--radius-full);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--elevation-3);
    opacity: 0;
    visibility: hidden;
    transform: translateY(20px);
    transition: all var(--transition-base);
    z-index: var(--z-fixed);
  }

  .back-to-top:hover {
    background: var(--color-primary-700);
    transform: translateY(-2px);
    box-shadow: var(--elevation-4);
  }

  .back-to-top:active {
    transform: translateY(0);
  }

  .back-to-top.visible {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .back-to-top svg {
    width: 24px;
    height: 24px;
  }

  @media (max-width: 768px) {
    .back-to-top {
      bottom: var(--space-4);
      right: var(--space-4);
      width: 44px;
      height: 44px;
    }

    .back-to-top svg {
      width: 20px;
      height: 20px;
    }
  }
</style>
